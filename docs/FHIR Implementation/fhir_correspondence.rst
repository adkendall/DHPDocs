Correspondence Service FHIR Implementation
==========================================

.. figure:: ../../img/CorrespondenceBusService.png
   :scale: 50 %
   :alt: Correspondence Service

Figure 1: Correspondence Service

The Correspondence service enables the electronic transmission of data between individuals or organisations which might otherwise be sent as a letter or other form of written communication. It differs from the "*Health and Care Information Business Service*" in that the information communicated is not necessarily structured and can include items such as a request to make an appointment, a notification that test results are available or supplementary information such as directions to a hospital.

For a business level description of the forms service see section "*Correspondence Business Service*" of this documentation.


FHIR Profiles
-------------

FHIR Profiles have been created and are available to download from this page. The
Access Control Engine (ACE) in the PHF uses the profile, which must be
specified in metadata, to make access control decisions based on scopes
contained within the OAuth2 Access Token. In the current implementation scope **phfapi.admin** 
is required to perform any CRUD operation on correspondence.

DhpCorrespondenceDocument
~~~~~~~~~~~~~~~~~~~~~~~~~

**FHIR Profile:** :download:`https://digitalhealthplatform.scot/fhir/DhpCorrespondenceDocument <Profiles/DhpCorrespondenceDocument.structuredefinition.xml>`

**Base Fhir Resource:** http://hl7.org/fhir/DSTU2/documentreference.html

**Description**: DhpCorrespondenceDocument is used to record a notification of correspondence between an organisation (e.g the NHS) and the citizen.

.. figure:: ../../img/DhpCorrespondenceDocument_forge.png
   :scale: 75 %
   :alt: DhpCorrespondenceDocument Element Tree

Figure2: DhpCorrespondenceDocument Element Tree

The following table is a `differential
statement <http://hl7.org/fhir/DSTU2/profiling.html#snapshot>`__ which
describes only the elements which have been modified from the base
profile. For a full description of all elements see also the FHIR
`DocumentReference <http://hl7.org/fhir/DSTU2/documentreference.html>`__ structure
definition.

+-----------------------------------+---------------------------------------------------------------------+
| **Attribute**                     | **Notes**                                                           |
+===================================+=====================================================================+
| subject                           | Subject is mandatory and must reference a Patient                   |
|                                   | resource                                                            |
+-----------------------------------+---------------------------------------------------------------------+
| type                              | Type must be a fixed string? TODO: Requires clarification           |
+-----------------------------------+---------------------------------------------------------------------+
| description                       | Human-readable description of the source document. This is sometimes|
|                                   | known as the "title". A description must be specified, either       |
|                                   | manually entered by staff or generated by middleware.               |
+-----------------------------------+---------------------------------------------------------------------+
| securityLabel                     | profiled out                                                        |
+-----------------------------------+---------------------------------------------------------------------+


**FHIR Interactions**

+-----------------------+-----------------------+-----------------------+
| **Scope**             | **Interactions**      | **Constraints**       |
+=======================+=======================+=======================+
| phfapi.admin          | create, read          | none                  |
+-----------------------+-----------------------+-----------------------+

MsnDocument
~~~~~~~~~~~~~~~~~~~~~~~~~

**FHIR Profiles:** 
   :download:`https://www.youngcancer.scot.nhs.uk/fhir/MsnScanImage <Profiles/MsnScanImage.structuredefinition.xml>`
   :download:`https://www.youngcancer.scot.nhs.uk/fhir/MsnAppointmentDoc <Profiles/MsnAppointmentDocument.structuredefinition.xml>`
   :download:`https://www.youngcancer.scot.nhs.uk/fhir/MsnBloodResultDoc <Profiles/MsnBloodResultDocument.structuredefinition.xml>`
   :download:`https://www.youngcancer.scot.nhs.uk/fhir/MsnDiagnosisDoc <Profiles/MsnDiagnosisDocument.structuredefinition.xml>`
   :download:`https://www.youngcancer.scot.nhs.uk/fhir/MsnEotSummaryDoc <Profiles/MsnEotSummaryDocument.structuredefinition.xml>`
   :download:`https://www.youngcancer.scot.nhs.uk/fhir/MsnLinksDoc <Profiles/MsnLinksDocument.structuredefinition.xml>`
   :download:`https://www.youngcancer.scot.nhs.uk/fhir/MsnTreatmentPlanDoc <Profiles/MsnTreatmentPlanDocument.structuredefinition.xml>`

**Base Fhir Resource:** http://hl7.org/fhir/DSTU2/documentreference.html

**Description**: Data in MSN is stored 7 different document types. A FHIR profile has been created for each type and is based upon the DocumentReference resource. 6 of the profiles are for PDF and 1 is for an image.
All documents are created by the Keyworker using an admin portal and read by the MSN app. Only One element tree image is shown below but the structure is the same for all types:


.. figure:: ../../img/MsnEotSummaryDocument_forge.png
   :scale: 75 %
   :alt: MsnEotSummaryDocument Element Tree

Figure2: MsnEotSummaryDocument Element Tree

The following table is a `differential
statement <http://hl7.org/fhir/DSTU2/profiling.html#snapshot>`__ which
describes only the elements which have been modified from the base
profile. For a full description of all elements see also the FHIR
`DocumentReference <http://hl7.org/fhir/DSTU2/documentreference.html>`__ structure
definition.

+-----------------------------------+---------------------------------------------------------------------+
| **Attribute**                     | **Notes**                                                           |
+===================================+=====================================================================+
| masterIdentifier                  | profiled out                                                        |
+-----------------------------------+---------------------------------------------------------------------+
| identifier                        | profiled out                                                        |
+-----------------------------------+---------------------------------------------------------------------+
| subject                           | Subject is mandatory and must reference a Patient                   |
|                                   | resource                                                            |
+-----------------------------------+---------------------------------------------------------------------+
| type                              | Type must be a fixed string. One of                                 |
|                                   |'MsnEotSummaryDoc', ‘MsnBloodResultDoc’,                             |
|                                   |’MsnAppointmentDoc’,’MsnDiagnosisDoc’,                               |
|                                   |‘MsnTreatmentPlanDoc’, ‘MsnLinksDoc’, ’MsnScanImg’                   |
|                                   |                                                                     |
+-----------------------------------+---------------------------------------------------------------------+
| class                             | profiled out                                                        |
+-----------------------------------+---------------------------------------------------------------------+
| author                            | profiled out                                                        |
+-----------------------------------+---------------------------------------------------------------------+
| custodian                         | profiled out                                                        |
+-----------------------------------+---------------------------------------------------------------------+
| authenticator                     | profiled out                                                        |
+-----------------------------------+---------------------------------------------------------------------+
| status                            | Fixed value 'current'                                               |
+-----------------------------------+---------------------------------------------------------------------+
| docStatus                         | profiled out                                                        |
+-----------------------------------+---------------------------------------------------------------------+
| relatesTo                         | profiled out                                                        |
+-----------------------------------+---------------------------------------------------------------------+
| description                       | A description must be specified, either manually                    |
|                                   | entered by a keyworker or generated by the Admin                    |
|                                   | portal                                                              |
+-----------------------------------+---------------------------------------------------------------------+
| securityLabel                     | profiled out                                                        |
+-----------------------------------+---------------------------------------------------------------------+
| context                           | profiled out                                                        |
+-----------------------------------+---------------------------------------------------------------------+
| uploadedby                        | The username of the Key Worker who uploaded the                     |
|                                   | document. This is an extension of type                              |
|                                   | ''https://www.youngcancer.scot.nhs.uk/fhir/MsnUploadedByExtension'' |
|                                   | which defines a single string value ‘UploadedBy’.                   |
|                                   |                                                                     |
+-----------------------------------+---------------------------------------------------------------------+


**FHIR Interactions**

+-----------------------+-----------------------+-----------------------+
| **Scope**             | **Interactions**      | **Constraints**       |
+=======================+=======================+=======================+
| phfapi.admin          | create, read, update, | none                  |
|                       | delete                |                       |
+-----------------------+-----------------------+-----------------------+

Usage Scenarios
---------------

Scenario 1
~~~~~~~~~~

+-----------------------------------+-----------------------------------------------------------------+
| Actor                             | Care Organisation (via a CA)                                    |
+-----------------------------------+-----------------------------------------------------------------+
| Interaction                       | POST {fhir base}/QuestionnaireResponse                          |
+-----------------------------------+-----------------------------------------------------------------+
| Mandatory Requirements            | 1) ``https://digitalhealthplatform.scot/fhir/AboutMeResponse``  | 
|                                   |    included in meta.profile                                     |
|                                   |                                                                 |
|                                   | 2) subject = Patient who is the subject of the questions        |
|                                   |                                                                 |
|                                   | 3) status = in-progress                                         |
|                                   |                                                                 |                                
|                                   | 4) correct questions defined as per profile definition          |
|                                   |                                                                 |
|                                   | 5) inform-subject meta tag added                                |
|                                   |    as per Notifications Service                                 |
|                                   |    profile                                                      |
+-----------------------------------+-----------------------------------------------------------------+
| Optional                          | 1) Any attributes inherited                                     |
|                                   |    from the base resource which                                 |
|                                   |    have not been profiled out.                                  |
+-----------------------------------+-----------------------------------------------------------------+

Search
~~~~~~

+-----------------------------------+-----------------------------------------------------------------------+
| Actor                             | Citizen (via a CA)                                                    |
+-----------------------------------+-----------------------------------------------------------------------+
| Interaction                       | GET {fhir base}/QuestionnaireResponse                                 |
+-----------------------------------+-----------------------------------------------------------------------+
| Parameters                        | _profile=``https://digitalhealthplatform.scot/fhir/AboutMeResponse``  |
|                                   | subject={PHF id of subject's Patient resource}                        |
+-----------------------------------+-----------------------------------------------------------------------+
| Comments                          | Used to determine if a Patient has an AboutMe form associated with    |
|                                   | their account. A Patient can have only 1 AboutForm. A resultset count |
|                                   | of > 1 must be treated as an error condition.                         |
|                                   |                                                                       |      
+-----------------------------------+-----------------------------------------------------------------------+

Profile List
------------

:download:`https://digitalhealthplatform.scot/fhir/DhpCorrespondenceDocument <Profiles/DhpCorrespondenceDocument.structuredefinition.xml>`
:download:`https://www.youngcancer.scot.nhs.uk/fhir/MsnScanImage <Profiles/MsnScanImage.structuredefinition.xml>`
:download:`https://www.youngcancer.scot.nhs.uk/fhir/MsnAppointmentDoc <Profiles/MsnAppointmentDoc.structuredefinition.xml>`
:download:`https://www.youngcancer.scot.nhs.uk/fhir/MsnBloodResultDoc <Profiles/MsnBloodResultDoc.structuredefinition.xml>`
:download:`https://www.youngcancer.scot.nhs.uk/fhir/MsnDiagnosisDoc <Profiles/MsnDiagnosisDoc.structuredefinition.xml>`
:download:`https://www.youngcancer.scot.nhs.uk/fhir/MsnEotSummaryDoc <Profiles/MsnEotSummaryDoc.structuredefinition.xml>`
:download:`https://www.youngcancer.scot.nhs.uk/fhir/MsnLinksDoc <Profiles/MsnLinksDoc.structuredefinition.xml>`
:download:`https://www.youngcancer.scot.nhs.uk/fhir/MsnTreatmentPlanDoc <Profiles/MsnTreatmentPlanDoc.structuredefinition.xml>`
:download:`https://www.youngcancer.scot.nhs.uk/fhir/MsnNote <Profiles/MsnNote.structuredefinition.xml>`
:download:`https://www.youngcancer.scot.nhs.uk/fhir/MsnUploadedByExtension <Profiles/MsnUploadedByExtension.structuredefinition.xml>`


Download Forge from https://simplifier.net/forge/download to view this profile.

Examples
----------------------


C# Examples
-------------------------


            
